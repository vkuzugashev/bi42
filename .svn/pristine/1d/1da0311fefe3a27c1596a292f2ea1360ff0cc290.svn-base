using System;
using System.Collections.Generic;
using System.Data.Entity;
using System.Linq;
using System.Web.Mvc;
using Bi42.Models;
using System.Web.Security;
using System.Web;

namespace bi42.Areas.Employer.Controllers
{
    public class FeedBackController : Controller
    {
        private DbModel db = new DbModel();

        [Authorize]
        [HttpGet]
        public ActionResult Index(int orderid, int profileid)
        {
            string UserID = User.Identity.Name;
            FeedBack feedBack = db.FeedBacks.SingleOrDefault(x => x.ProfileID == profileid && x.OrderID == orderid && x.UserID == UserID);
            if(feedBack==null)
                feedBack = new FeedBack();
            feedBack.ProfileID = profileid;
            feedBack.OrderID = orderid;
            return View(feedBack);
        }

        [Authorize]
        [HttpPost]
        public ActionResult FeedBack()
        {
            FeedBack feedBack = new FeedBack();
            if (TryUpdateModel<FeedBack>(feedBack))
            {
                string UserID = User.Identity.Name;
                if (feedBack.PublishTime == null)
                    feedBack.PublishTime = DateTime.Now;
                db.FeedBacks.Add(feedBack);
                db.SaveChanges();
            }
            return RedirectToAction("Details", new { orderid = feedBack.OrderID });
        }


        protected override void Dispose(bool disposing)
        {
            db.Dispose();
            base.Dispose(disposing);
        }
    }
}